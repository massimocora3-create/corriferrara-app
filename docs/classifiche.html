<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8">
<title>Classifiche Corriferrara</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.5.2/papaparse.min.js"></script>

<style>
  body {
    font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    background: #f4f6fa; margin: 0; padding: 0; color: #0a2540;
  }
  .page-wrapper {
    max-width: 1100px; margin: 20px auto 40px; padding: 25px;
    background:#fff; border-radius:18px;
    box-shadow:0 10px 30px rgba(0,0,0,0.08);
  }
  .page-title { text-align:center; font-size:28px; font-weight:800; margin-bottom:5px; }
  .page-subtitle { text-align:center; font-size:15px; color:#555; }

  .tabs-bar {
    display:flex; flex-wrap:wrap; gap:8px;
    margin-top:20px; padding-bottom:8px;
    border-bottom:1px solid rgba(10,37,64,0.12);
  }
  .tab-button {
    border:none; padding:8px 14px; border-radius:999px;
    background:#e4ebf5; color:#0a2540; cursor:pointer; font-weight:600;
  }
  .tab-button.active { background:#0a2540; color:#fff; }

  .tab-content { display:none; margin-top:20px; }
  .tab-content.active { display:block; }

  table.dataTable thead th {
    background:#0a2540; color:#fff; font-size:12px;
    text-transform:uppercase; letter-spacing:.04em;
  }
  table.dataTable tbody tr:nth-child(even) { background:#f7f9fc; }
  table.dataTable tbody tr:hover { background:#e9f0fb; }
</style>
</head>
<body>

<div class="page-wrapper">

  <p style="color:#b22222;font-size:13px;">
    Se leggi questo testo, l'HTML Ã¨ caricato correttamente. Se le tabelle sotto sono vuote, il problema Ã¨ nel caricamento dei dati.
  </p>

  <h1 class="page-title">Classifiche Corriferrara 2025</h1>
  <p class="page-subtitle">Le classifiche si aggiornano automaticamente dal foglio Google.</p>

  <div class="tabs-bar">
    <button class="tab-button active" data-tab="tab-contakm">Conta KM</button>
    <button class="tab-button" data-tab="tab-punti-m">Punti Maschile</button>
    <button class="tab-button" data-tab="tab-punti-f">Punti Femminile</button>
    <button class="tab-button" data-tab="tab-trail-m">Trail Maschile</button>
    <button class="tab-button" data-tab="tab-trail-f">Trail Femminile</button>
    <button class="tab-button" data-tab="tab-ranking-m">Ranking Maschile</button>
    <button class="tab-button" data-tab="tab-ranking-f">Ranking Femminile</button>
  </div>

  <div id="tab-contakm" class="tab-content active"><table id="table-contakm" class="display"></table></div>
  <div id="tab-punti-m" class="tab-content"><table id="table-punti-m" class="display"></table></div>
  <div id="tab-punti-f" class="tab-content"><table id="table-punti-f" class="display"></table></div>
  <div id="tab-trail-m" class="tab-content"><table id="table-trail-m" class="display"></table></div>
  <div id="tab-trail-f" class="tab-content"><table id="table-trail-f" class="display"></table></div>
  <div id="tab-ranking-m" class="tab-content"><table id="table-ranking-m" class="display"></table></div>
  <div id="tab-ranking-f" class="tab-content"><table id="table-ranking-f" class="display"></table></div>

</div>

<script>
// ðŸŽ¯ LINK CSV gviz (compatibili CORS)
const classifiche = [
  {
    id: "table-contakm",
    url: "https://docs.google.com/spreadsheets/d/1uVa58NHACO4BtcMNxDWpx-AKbFe5P1DOxQSloJ29bUg/gviz/tq?tqx=out:csv&sheet=Conta%20KM"
  },
  {
    id: "table-punti-m",
    url: "https://docs.google.com/spreadsheets/d/1uVa58NHACO4BtcMNxDWpx-AKbFe5P1DOxQSloJ29bUg/gviz/tq?tqx=out:csv&sheet=Punti%20Maschile"
  },
  {
    id: "table-punti-f",
    url: "https://docs.google.com/spreadsheets/d/1uVa58NHACO4BtcMNxDWpx-AKbFe5P1DOxQSloJ29bUg/gviz/tq?tqx=out:csv&sheet=Punti%20Femminile"
  },
  {
    id: "table-trail-m",
    url: "https://docs.google.com/spreadsheets/d/1uVa58NHACO4BtcMNxDWpx-AKbFe5P1DOxQSloJ29bUg/gviz/tq?tqx=out:csv&sheet=Trail%20Maschile"
  },
  {
    id: "table-trail-f",
    url: "https://docs.google.com/spreadsheets/d/1uVa58NHACO4BtcMNxDWpx-AKbFe5P1DOxQSloJ29bUg/gviz/tq?tqx=out:csv&sheet=Trail%20Femminile"
  },
  {
    id: "table-ranking-m",
    url: "https://docs.google.com/spreadsheets/d/1uVa58NHACO4BtcMNxDWpx-AKbFe5P1DOxQSloJ29bUg/gviz/tq?tqx=out:csv&sheet=Ranking%20Maschile"
  },
  {
    id: "table-ranking-f",
    url: "https://docs.google.com/spreadsheets/d/1uVa58NHACO4BtcMNxDWpx-AKbFe5P1DOxQSloJ29bUg/gviz/tq?tqx=out:csv&sheet=Ranking%20Femminile"
  }
];

// ðŸ“¥ CARICA CSV
function loadCSV(cfg) {
  Papa.parse(cfg.url, {
    download: true,
    header: false,
    complete: function(res) {
      const data = res.data;
      if (!data || data.length === 0) {
        console.log("Nessun dato per", cfg.id);
        return;
      }

      const header = data[0];
      const rows = data.slice(1);

      let html = "<thead><tr>";
      header.forEach(h => html += `<th>${h}</th>`);
      html += "</tr></thead><tbody>";

      rows.forEach(r => {
        if (r.join("").trim() === "") return;
        html += "<tr>";
        r.forEach(c => html += `<td>${c}</td>`);
        html += "</tr>";
      });

      html += "</tbody>";
      document.getElementById(cfg.id).innerHTML = html;

      $("#" + cfg.id).DataTable({
        pageLength: 25,
        language: { url:"https://cdn.datatables.net/plug-ins/1.13.6/i18n/it-IT.json" }
      });
    },
    error: function(err) {
      console.log("Errore PapaParse per", cfg.id, err);
    }
  });
}

// ðŸ” Tabs
document.querySelectorAll(".tab-button").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".tab-button").forEach(b => b.classList.remove("active"));
    document.querySelectorAll(".tab-content").forEach(t => t.classList.remove("active"));
    btn.classList.add("active");
    document.getElementById(btn.dataset.tab).classList.add("active");
  });
});

// ðŸš€ Carica tutte le classifiche
document.addEventListener("DOMContentLoaded", () => {
  classifiche.forEach(loadCSV);
});
</script>

</body>
</html>
